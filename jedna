using NUnit.Framework;
using Microsoft.EntityFrameworkCore;
using System.Collections.Generic;
using System.Linq;

[TestFixture]
public class AgentServiceTests
{
    [Test]
    public void GetAgentsForApplication_ReturnsCorrectAgents()
    {
        // Arrange
        var options = new DbContextOptionsBuilder<MyDbContext>()
            .UseInMemoryDatabase(databaseName: "TestDb")
            .Options;

        // Seed data
        using (var context = new MyDbContext(options))
        {
            context.Agents.Add(new Agent { AgentId = 1, AgentName = "Agent1" });
            context.Flags.Add(new Flag { FlagId = 1, FlagName = "Flag1" });
            context.AgentFlags.Add(new AgentFlag { AgentId = 1, FlagId = 1 });
            context.Applications.Add(new Application { ApplicationId = 1, ApplicationName = "App1" });
            context.ApplicationFlags.Add(new ApplicationFlag { ApplicationId = 1, FlagId = 1 });
            context.SaveChanges();
        }

        // Act
        List<Agent> agents;
        using (var context = new MyDbContext(options))
        {
            var service = new AgentService(context);
            agents = service.GetAgentsForApplication(1);
        }

        // Assert
        Assert.AreEqual(1, agents.Count);
        Assert.AreEqual("Agent1", agents.First().AgentName);
    }
}
