using System;
using System.Threading;

class Program
{
    static void Main(string[] args)
    {
        while (true) // Infinite loop
        {
            // Get the current time
            DateTime now = DateTime.Now;

            // Check if it's the first day of the month and the time is 3:00 AM
            if (now.Day == 1 && now.Hour == 3 && now.Minute == 0)
            {
                // Code to execute once a month goes here
                Console.WriteLine("Executing task...");

                // Wait for 60 seconds (1 minute) after execution to prevent the task from running multiple times in the same minute
                Thread.Sleep(60000);
            }
            else
            {
                // Calculate the time remaining until 3:00 AM on the first day of the next month
                DateTime nextMonth = new DateTime(now.Year, now.Month, 1).AddMonths(1);
                DateTime nextExecutionTime = new DateTime(nextMonth.Year, nextMonth.Month, 1, 3, 0, 0);
                TimeSpan timeUntilNextExecution = nextExecutionTime - now;

                // If it's past 3:00 AM on the first day, adjust for the next month
                if (timeUntilNextExecution.TotalMilliseconds < 0)
                {
                    nextMonth = nextMonth.AddMonths(1);
                    nextExecutionTime = new DateTime(nextMonth.Year, nextMonth.Month, 1, 3, 0, 0);
                    timeUntilNextExecution = nextExecutionTime - now;
                }

                // Sleep until the next execution time (convert to milliseconds)
                Console.WriteLine($"Waiting for next execution: {nextExecutionTime}");
                Thread.Sleep((int)timeUntilNextExecution.TotalMilliseconds);
            }
        }
    }
}